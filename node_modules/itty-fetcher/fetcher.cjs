"use strict";exports.fetcher=(e,s)=>{let t="string"==typeof e?{base:e,...s}:e||{};return new Proxy(()=>{},{get:(e,s)=>(...e)=>(async(e,s,t,r=("string"==typeof t[0]?t.shift():""),a=("GET"!=e?t.shift():null),n={...s,...t.shift(),method:e},o=new Headers(s.headers),i="string"==typeof a,f=s.base??"")=>{r=new URL((r.includes("://")?r:(f.includes?.("://")?f:globalThis.location?.href+"/"+f)+(r?"/"+r:"")).replace(/\/+/g,"/"));for(let e in n.query||{})r.searchParams.append(e,n.query[e]);n.body=a,a&&0!=n.encode&&(n.body=i?a:JSON.stringify(a),i||o.set("content-type","application/json"));for(let[e,s]of new Headers(n.headers||[]))o.set(e,s);let c=await(n.fetch||fetch)(new Request(r,{...n,headers:o})),p=c.ok?void 0:Object.assign(new Error(c.statusText),{status:c.status,response:c});if(n.parse??"json")try{c=await c[n.parse??"json"](),p&&"json"==(n.parse??"json")&&(p={...p,...c})}catch(e){p||(p=Object.assign(new Error(e.message),{status:c.status,response:c}))}for(let e of n.after||[])c=await e(c)??c;if(n.array)return[p,p?void 0:c];if(p)throw p;return c})(s.toUpperCase(),t,e)})};
